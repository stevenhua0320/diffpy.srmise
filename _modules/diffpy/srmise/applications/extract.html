<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>diffpy.srmise.applications.extract &mdash; diffpy.srmise 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=f539c95a"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            diffpy.srmise
          </a>
              <div class="version">
                0.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/diffpy.srmise.html">Package API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">diffpy.srmise</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">diffpy.srmise.applications.extract</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for diffpy.srmise.applications.extract</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># SrMise            by Luke Granlund</span>
<span class="c1">#                   (c) 2014-2015 trustees of the Michigan State University.</span>
<span class="c1">#                   All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># File coded by:    Luke Granlund</span>
<span class="c1">#</span>
<span class="c1"># See LICENSE.txt for license information.</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>

<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">IndentedHelpFormatter</span><span class="p">,</span> <span class="n">OptionGroup</span><span class="p">,</span> <span class="n">OptionParser</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../../../api/diffpy.srmise.applications.html#diffpy.srmise.applications.extract.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Default SrMise entry-point.&quot;&quot;&quot;</span>

    <span class="n">usage</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;usage: %prog pdf_file [options]</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;pdf_file is a file containing a PDF (accepts several &quot;</span>
        <span class="s2">&quot;common formats), or a .srmise file.&quot;</span>
    <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">diffpy.srmise</span> <span class="kn">import</span> <span class="n">__version__</span>

    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;diffpy.srmise &quot;</span> <span class="o">+</span> <span class="n">__version__</span>

    <span class="n">descr</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;The SrMise package is a tool to aid extracting and fitting peaks &quot;</span>
        <span class="s2">&quot;that comprise a pair distribution function.  This script exposes &quot;</span>
        <span class="s2">&quot;basic peak extraction functionality. For many PDFs it is &quot;</span>
        <span class="s2">&quot;sufficient to specify the range, baseline, and sometimes an ad &quot;</span>
        <span class="s2">&quot;hoc uncertainty. See the discussion of these options below for &quot;</span>
        <span class="s2">&quot;further guidance.&quot;</span>
    <span class="p">)</span>

    <span class="n">epilog</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Options set above override those from an existing .srmise &quot;</span>
        <span class="s2">&quot;file, as well as the usual defaults summarized here.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Defaults (when qmax &gt; 0)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;------------------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;baseline - None (identically 0).</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;dg - The uncertainty reported in the PDF (if any), otherwise &quot;</span>
        <span class="s2">&quot;5</span><span class="si">% o</span><span class="s2">f maximum value of PDF.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;nyquist - True</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;range - All the data</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;cres - The Nyquist rate.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;supersample - 4.0</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;scale - (Deprecated) False</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Defaults (when qmax = 0)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;------------------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;baseline - as above</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;dg - as above</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;nyquist - False (and no effect if True)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;range - as above</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;cres - Four times the average distance between data points</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;supersample - Parameter has no effect.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;scale - (Deprecated) False, and no effect if True</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Known issues</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;1) Peak extraction works best when the data are moderately &quot;</span>
        <span class="s2">&quot;oversampled first.  When qmax &gt; 0 this is handled &quot;</span>
        <span class="s2">&quot;automatically, but when qmax = 0 no resampling of any kind is &quot;</span>
        <span class="s2">&quot;performed.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;2) Peak extraction performed on a PDF file and a .srmise file &quot;</span>
        <span class="s2">&quot;derived from that data with identical extraction parameters &quot;</span>
        <span class="s2">&quot;can give different results even on the same platform.  This is &quot;</span>
        <span class="s2">&quot;because the original data may undergo some processing before it &quot;</span>
        <span class="s2">&quot;can be saved by SrMise.  For consistent results, always specify &quot;</span>
        <span class="s2">&quot;the original PDF, or always load the PDF from a .srmise file &quot;</span>
        <span class="s2">&quot;you save before performing any peak extraction on that data.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;3) Liveplotting depends on the matplotlib backend, and doesn&#39;t &quot;</span>
        <span class="s2">&quot;implement an idle handler, so interaction with its window will &quot;</span>
        <span class="s2">&quot;likely cause a freeze.&quot;</span>
    <span class="p">)</span>

    <span class="c1"># TODO: Move to argparse (though not in 2.6 by default) to handle</span>
    <span class="c1"># variable-length options without callbacks.  Longterm, the major</span>
    <span class="c1"># value is using the same option to specify a baseline that should</span>
    <span class="c1"># use estimation vs. one that should use explicitly provided pars.</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span>
        <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">descr</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="n">epilog</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
        <span class="n">formatter</span><span class="o">=</span><span class="n">IndentedHelpFormatterWithNL</span><span class="p">(),</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span>
        <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">liveplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">performextraction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">dg_defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;absolute&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;max-fraction&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="s2">&quot;ptp-fraction&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="s2">&quot;dG-fraction&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--extract&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;performextraction&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;[Default] Perform extraction.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--no-extract&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;performextraction&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not perform extraction.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--range&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;rng&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;rmin rmax&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract over the range (rmin, rmax).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--qmax&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;qmax&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;QMAX&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Model peaks with this maximum q value.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--nyquist&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;nyquist&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use Nyquist resampling if qmax &gt; 0.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--no-nyquist&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;nyquist&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not use Nyquist resampling.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--pf&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;peakfunction&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;PF&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Fit peak function PF defined in &quot;</span> <span class="s2">&quot;diffpy.srmise.peaks, e.g. &quot;</span> <span class="s2">&quot;&#39;GaussianOverR(maxwidth=0.7)&#39;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--cres&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cres&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;cres&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Clustering resolution.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--supersample&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;supersample&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SS&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Minimum initial oversampling rate as multiple of &quot;</span> <span class="s2">&quot;Nyquist rate.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--me&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;modelevaluator&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;ME&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ModelEvaluator defined in &quot;</span> <span class="s2">&quot;diffpy.srmise.modelevaluators, e.g. &#39;AIC&#39;&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span>
        <span class="n">parser</span><span class="p">,</span>
        <span class="s2">&quot;Baseline Options&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SrMise cannot determine the appropriate type of &quot;</span>
        <span class="s2">&quot;baseline (e.g. crystalline vs. some nanoparticle) &quot;</span>
        <span class="s2">&quot;solely from the data, so the user should specify the &quot;</span>
        <span class="s2">&quot;appropriate type and/or parameters. (Default is &quot;</span>
        <span class="s2">&quot;identically 0, which is unphysical.) SrMise keeps the &quot;</span>
        <span class="s2">&quot;PDF baseline fixed at its initial value until the &quot;</span>
        <span class="s2">&quot;final stages of peak extraction, so results are &quot;</span>
        <span class="s2">&quot;frequently conditioned on that choice. (See the &quot;</span>
        <span class="s2">&quot;SrMise documentation for details.)  A good estimate &quot;</span>
        <span class="s2">&quot;is therefore important for best results.  SrMise can &quot;</span>
        <span class="s2">&quot;estimate initial parameters from the data for linear &quot;</span>
        <span class="s2">&quot;baselines in some situations (all peaks are positive, &quot;</span>
        <span class="s2">&quot;and the degree of overlap in the region of extraction &quot;</span>
        <span class="s2">&quot;is not too great), but in most cases it is best to &quot;</span>
        <span class="s2">&quot;provide reasonable initial parameters.  Run &#39;srmise &quot;</span>
        <span class="s2">&quot;pdf_file.gr [baseline_option] --no-extract --plot&#39; &quot;</span>
        <span class="s2">&quot;for different values of the parameters for rapid &quot;</span>
        <span class="s2">&quot;visual estimation.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--baseline&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;BL&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Estimate baseline from baseline function BL &quot;</span>
        <span class="s2">&quot;defined in diffpy.srmise.baselines, e.g. &quot;</span>
        <span class="s2">&quot;&#39;Polynomial(degree=1)&#39;.  All parameters are free. &quot;</span>
        <span class="s2">&quot;(Many POSIX shells attempt to interpret the &quot;</span>
        <span class="s2">&quot;parentheses, and on these shells the option should &quot;</span>
        <span class="s2">&quot;be surrounded by quotation marks.)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--bcrystal&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bcrystal&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;rho0[c]&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use linear baseline defined by crystal number &quot;</span>
        <span class="s2">&quot;density rho0. Append &#39;c&#39; to make parameter &quot;</span>
        <span class="s2">&quot;constant. Equivalent to &quot;</span>
        <span class="s2">&quot;&#39;--bpoly1 -4*pi*rho0[c] 0c&#39;.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--bsrmise&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bsrmise&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use baseline from specified .srmise file.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--bpoly0&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bpoly0&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;a0[c]&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use constant baseline given by y=a0. &quot;</span> <span class="s2">&quot;Append &#39;c&#39; to make parameter constant.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--bpoly1&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bpoly1&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;a1[c] a0[c]&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use baseline given by y=a1*x + a0.  Append &#39;c&#39; to &quot;</span> <span class="s2">&quot;make parameter constant.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--bpoly2&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bpoly2&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;a2[c] a1[c] a0[c]&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use baseline given by y=a2*x^2+a1*x + a0.  Append &quot;</span> <span class="s2">&quot;&#39;c&#39; to make parameter constant.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--bseq&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bseq&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use baseline interpolated from x,y values in FILE. &quot;</span> <span class="s2">&quot;This baseline has no free parameters.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--bspherical&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;bspherical&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;s[c] r[c]&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use spherical nanoparticle baseline with scale s &quot;</span>
        <span class="s2">&quot;and radius r. Append &#39;c&#39; to make parameter &quot;</span>
        <span class="s2">&quot;constant.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span>
        <span class="n">parser</span><span class="p">,</span>
        <span class="s2">&quot;Uncertainty Options&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Ideally a PDF reports the accurate experimentally &quot;</span>
        <span class="s2">&quot;determined uncertainty.  In practice, many PDFs &quot;</span>
        <span class="s2">&quot;report none, while for others the reported values &quot;</span>
        <span class="s2">&quot;are not necessarily reliable. (If in doubt, ask your &quot;</span>
        <span class="s2">&quot;friendly neighborhood diffraction expert!) Even when &quot;</span>
        <span class="s2">&quot;uncertainties are accurate, it can be &quot;</span>
        <span class="s2">&quot;pragmatically useful to see how the results of &quot;</span>
        <span class="s2">&quot;peak extraction change when assuming a different &quot;</span>
        <span class="s2">&quot;value.  Nevertheless, the primary determinant of &quot;</span>
        <span class="s2">&quot;model complexity in SrMise is the uncertainty, so an &quot;</span>
        <span class="s2">&quot;ad hoc uncertainty yields ad hoc model complexity. &quot;</span>
        <span class="s2">&quot;See the SrMise documentation for further discussion, &quot;</span>
        <span class="s2">&quot;including methods to mitigate this issue with &quot;</span>
        <span class="s2">&quot;multimodel selection.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--dg-mode&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;dg_mode&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;choice&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;absolute&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;max-fraction&quot;</span><span class="p">,</span> <span class="s2">&quot;ptp-fraction&quot;</span><span class="p">,</span> <span class="s2">&quot;dG-fraction&quot;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Define how values passed to &#39;--dg&#39; are treated. &quot;</span>
        <span class="s2">&quot;Possible values are: </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&#39;absolute&#39; - The actual uncertainty in the PDF.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&#39;max-fraction&#39; - Fraction of max value in PDF.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&#39;ptp-fraction&#39; - Fraction of max minus min value &quot;</span>
        <span class="s2">&quot;in the PDF.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&#39;dG-fraction&#39; - Fraction of dG reported by PDF.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;If &#39;--dg&#39; is specified but mode is not, then mode &quot;</span>
        <span class="s2">&quot;ia absolute.  Otherwise, &#39;dG-fraction&#39; is default &quot;</span>
        <span class="s2">&quot;if the PDF reports uncertaintes, and &#39;max-fraction&#39; &quot;</span>
        <span class="s2">&quot;ia default if it does not.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--dg&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;dg&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Perform extraction assuming uncertainty dg. &quot;</span>
        <span class="s2">&quot;Defaults depend on --dg-mode as follows:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&#39;absolute&#39;=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&#39;max-fraction&#39;=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&#39;ptp-fraction&#39;=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;&#39;dG-fraction&#39;=</span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span>
            <span class="n">dg_defaults</span><span class="p">[</span><span class="s2">&quot;absolute&quot;</span><span class="p">],</span>
            <span class="n">dg_defaults</span><span class="p">[</span><span class="s2">&quot;max-fraction&quot;</span><span class="p">],</span>
            <span class="n">dg_defaults</span><span class="p">[</span><span class="s2">&quot;ptp-fraction&quot;</span><span class="p">],</span>
            <span class="n">dg_defaults</span><span class="p">[</span><span class="s2">&quot;dG-fraction&quot;</span><span class="p">],</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="c1">#    group.add_option(&quot;--multimodel&quot;, nargs=3, dest=&quot;multimodel&quot;, type=&quot;float&quot;,</span>
    <span class="c1">#                     metavar=&quot;dg_min dg_max n&quot;,</span>
    <span class="c1">#                     help=&quot;Generate n models from dg_min to dg_max (given by &quot;</span>
    <span class="c1">#                          &quot;--dg-mode) and perform multimodel analysis. &quot;</span>
    <span class="c1">#                          &quot;This overrides any value given for --dg&quot;)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;Saving and Plotting Options&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--pwa&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pwafile&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Save summary of result to FILE (.pwa format).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--save&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;savefile&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Save result of extraction to FILE (.srmise &quot;</span> <span class="s2">&quot;format).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--plot&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot extracted peaks.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--liveplot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;liveplot&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(Experimental) Plot extracted peaks when fitting.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--wait&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;wait&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(Experimental) When using liveplot wait for user &quot;</span> <span class="s2">&quot;after plotting.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;Verbosity Options&quot;</span><span class="p">,</span> <span class="s2">&quot;Control detail printed to console.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--informative&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbosity&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Summary of progress.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-q&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbosity&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;[Default] Show minimal summary.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--silent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbosity&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;No non-critical output.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbosity&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show verbose output.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;Deprecated Options&quot;</span><span class="p">,</span> <span class="s2">&quot;Not for general use.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--scale&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(Deprecated) Scale supersampled uncertainties by &quot;</span>
        <span class="s2">&quot;sqrt(oversampling) in intermediate steps when &quot;</span>
        <span class="s2">&quot;Nyquist sampling.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--no-scale&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(Deprecated) Never rescale uncertainties.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exactly one argument required. </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">usage</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">diffpy.srmise</span> <span class="kn">import</span> <span class="n">srmiselog</span>

    <span class="n">srmiselog</span><span class="o">.</span><span class="n">setlevel</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">diffpy.srmise.pdfpeakextraction</span> <span class="kn">import</span> <span class="n">PDFPeakExtraction</span>
    <span class="kn">from</span> <span class="nn">diffpy.srmise.srmiseerrors</span> <span class="kn">import</span> <span class="n">SrMiseDataFormatError</span><span class="p">,</span> <span class="n">SrMiseFileError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">peakfunction</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;peaks.&quot;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">peakfunction</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not create peak function &#39;</span><span class="si">%s</span><span class="s2">&#39;. Exiting.&quot;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">peakfunction</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">modelevaluator</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;modelevaluators.&quot;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">modelevaluator</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not find ModelEvaluator &#39;</span><span class="si">%s</span><span class="s2">&#39;. Exiting.&quot;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">modelevaluator</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">bcrystal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">diffpy.srmise.baselines.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>

        <span class="n">bl</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">parsepars</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">bcrystal</span><span class="p">,</span> <span class="s2">&quot;0c&quot;</span><span class="p">])</span>
        <span class="n">options</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">options</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">bsrmise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use baseline from existing file</span>
        <span class="n">blext</span> <span class="o">=</span> <span class="n">PDFPeakExtraction</span><span class="p">()</span>
        <span class="n">blext</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">bsrmise</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">blext</span><span class="o">.</span><span class="n">extracted</span><span class="o">.</span><span class="n">baseline</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">bpoly0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">diffpy.srmise.baselines.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>

        <span class="n">bl</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">parsepars</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">bpoly0</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">bpoly1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">diffpy.srmise.baselines.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>

        <span class="n">bl</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">parsepars</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">bpoly1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">bpoly2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">diffpy.srmise.baselines.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>

        <span class="n">bl</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">parsepars</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">bpoly2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">bseq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">diffpy.srmise.baselines.fromsequence</span> <span class="kn">import</span> <span class="n">FromSequence</span>

        <span class="n">bl</span> <span class="o">=</span> <span class="n">FromSequence</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">bseq</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">actualize</span><span class="p">([],</span> <span class="s2">&quot;internal&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">bspherical</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">diffpy.srmise.baselines.nanospherical</span> <span class="kn">import</span> <span class="n">NanoSpherical</span>

        <span class="n">bl</span> <span class="o">=</span> <span class="n">NanoSpherical</span><span class="p">()</span>
        <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">parsepars</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">bspherical</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;baselines.&quot;</span> <span class="o">+</span> <span class="n">options</span><span class="o">.</span><span class="n">baseline</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not create baseline &#39;</span><span class="si">%s</span><span class="s2">&#39;. Exiting.&quot;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">baseline</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">PDFPeakExtraction</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ext</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">SrMiseDataFormatError</span><span class="p">,</span> <span class="n">SrMiseFileError</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="n">ext</span><span class="o">.</span><span class="n">loadpdf</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">pdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">peakfunction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;pf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">peakfunction</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">baseline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">baseline</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">cres</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;cres&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">cres</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">dg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span> <span class="o">=</span> <span class="s2">&quot;absolute&quot;</span>
            <span class="k">elif</span> <span class="n">ext</span><span class="o">.</span><span class="n">dy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span> <span class="o">=</span> <span class="s2">&quot;max-fraction&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span> <span class="o">=</span> <span class="s2">&quot;dG-fraction&quot;</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">dg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">dg</span> <span class="o">=</span> <span class="n">dg_defaults</span><span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span> <span class="o">==</span> <span class="s2">&quot;absolute&quot;</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;effective_dy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">dg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span> <span class="o">==</span> <span class="s2">&quot;max-fraction&quot;</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;effective_dy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">dg</span> <span class="o">*</span> <span class="n">ext</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span> <span class="o">==</span> <span class="s2">&quot;ptp-fraction&quot;</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;effective_dy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">dg</span> <span class="o">*</span> <span class="n">ext</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">dg_mode</span> <span class="o">==</span> <span class="s2">&quot;dG-fraction&quot;</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;effective_dy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">dg</span> <span class="o">*</span> <span class="n">ext</span><span class="o">.</span><span class="n">dy</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">rng</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;rng&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">qmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;qmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">qmax</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">qmax</span> <span class="o">==</span> <span class="s2">&quot;automatic&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">qmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">nyquist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;nyquist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">nyquist</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">supersample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;supersample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">supersample</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">scale</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">modelevaluator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;error_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">modelevaluator</span>

        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">liveplot</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">diffpy.srmise</span> <span class="kn">import</span> <span class="n">srmiselog</span>

            <span class="n">srmiselog</span><span class="o">.</span><span class="n">liveplotting</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">wait</span><span class="p">)</span>

        <span class="n">ext</span><span class="o">.</span><span class="n">setvars</span><span class="p">(</span><span class="o">**</span><span class="n">pdict</span><span class="p">)</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">performextraction</span><span class="p">:</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">savefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ext</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">SrMiseFileError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not save result to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">pwafile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ext</span><span class="o">.</span><span class="n">writepwa</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pwafile</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">SrMiseFileError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not save pwa summary to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">pwafile</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">plot</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">diffpy.srmise.applications.plot</span> <span class="kn">import</span> <span class="n">makeplot</span>

            <span class="n">makeplot</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">liveplot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>



<div class="viewcode-block" id="parsepars">
<a class="viewcode-back" href="../../../../api/diffpy.srmise.applications.html#diffpy.srmise.applications.extract.parsepars">[docs]</a>
<span class="k">def</span> <span class="nf">parsepars</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">parseq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return actualized model from sequence of strings.</span>

<span class="sd">    Each item in parseq must be interpretable as a float, or as</span>
<span class="sd">    a float with the character &#39;c&#39; appended.  If &#39;c&#39; is appended,</span>
<span class="sd">    that parameter will be fixed.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    mp - A ModelPart instance</span>
<span class="sd">    parseq - A sequence of string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parseq</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">free</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
            <span class="n">free</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mp</span><span class="o">.</span><span class="n">actualize</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="s2">&quot;internal&quot;</span><span class="p">,</span> <span class="n">free</span><span class="o">=</span><span class="n">free</span><span class="p">)</span></div>



<span class="c1"># Class to preserve newlines in optparse</span>
<span class="c1"># Borrowed, with minor changes, from</span>
<span class="c1"># http://groups.google.com/group/comp.lang.python/browse_frm/thread/6df6e6b541a15bc2/09f28e26af0699b1</span>


<div class="viewcode-block" id="IndentedHelpFormatterWithNL">
<a class="viewcode-back" href="../../../../api/diffpy.srmise.applications.html#diffpy.srmise.applications.extract.IndentedHelpFormatterWithNL">[docs]</a>
<span class="k">class</span> <span class="nc">IndentedHelpFormatterWithNL</span><span class="p">(</span><span class="n">IndentedHelpFormatter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="n">text_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span>
        <span class="c1"># the above is still the same</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">formatted_bits</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="n">text_width</span><span class="p">,</span> <span class="n">initial_indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span> <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bits</span>
        <span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_bits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="IndentedHelpFormatterWithNL.format_option">
<a class="viewcode-back" href="../../../../api/diffpy.srmise.applications.html#diffpy.srmise.applications.extract.IndentedHelpFormatterWithNL.format_option">[docs]</a>
    <span class="k">def</span> <span class="nf">format_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="c1"># The help for each option consists of two parts:</span>
        <span class="c1">#   * the opt strings and metavars</span>
        <span class="c1">#   eg. (&quot;-x&quot;, or &quot;-fFILENAME, --file=FILENAME&quot;)</span>
        <span class="c1">#   * the user-supplied help string</span>
        <span class="c1">#   eg. (&quot;turn on expert mode&quot;, &quot;read data from FILENAME&quot;)</span>
        <span class="c1">#</span>
        <span class="c1"># If possible, we write both of these on the same line:</span>
        <span class="c1">#   -x    turn on expert mode</span>
        <span class="c1">#</span>
        <span class="c1"># But if the opt string list is too long, we put the help</span>
        <span class="c1"># string on a second line, indented to the same column it would</span>
        <span class="c1"># start in if it fit on the first line.</span>
        <span class="c1">#   -fFILENAME, --file=FILENAME</span>
        <span class="c1">#       read data from FILENAME</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_strings</span><span class="p">[</span><span class="n">option</span><span class="p">]</span>
        <span class="n">opt_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">opt_width</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
            <span class="n">indent_first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_position</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># start help on same line as opts</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%*s%-*s</span><span class="s2">  &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">opt_width</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
            <span class="n">indent_first</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="n">help_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_default</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
            <span class="c1"># Everything is the same up through here</span>
            <span class="n">help_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">help_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">help_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">para</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_width</span><span class="p">))</span>
            <span class="c1"># Everything is the same after here</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent_first</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">help_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_position</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">help_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="k">elif</span> <span class="n">opts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
</div>



<span class="c1"># End class</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, The Trustees of Columbia University in the City of New York.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>